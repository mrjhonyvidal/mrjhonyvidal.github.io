<!DOCTYPE html>
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <title>Building a Test-Driven REST Subscription API</title>
    <meta name="description" content="Using best practices">
    <link rel="canonical" href="http://localhost:4000/posts/2018-02-19-building-a-test-driven-rest-subscription-api/">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/stylesheets/main.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:400,400i,600,600i|Fira+Sans+Condensed">
  

  
</head>


  <body class="layout--page building-a-test-driven-rest-subscription-api">

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>


    <div class="sidebar-toggle-wrapper">
      <button class="toggle navicon-button larr" type="button">
        <span class="toggle-inner">
          <span class="sidebar-toggle-label">menu</span>
          <span class="navicon"></span>
        </span>
      </button>
    </div>

    <div id="sidebar" class="sidebar">
      <div class="inner">
        <nav id="nav-primary" class="site-nav" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <ul id="menu-main-navigation" class="menu">
    <!-- Home link -->
    <li class="menu-item">
      <a href="/" itemprop="url">
        <span itemprop="name">Home</span>
      </a>
    </li>

    <!-- site.pages links -->
    
    

    
      
      
        <li class="menu-item">
          <a href="/about/" itemprop="url">
            <span itemprop="name">About me</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/posts/" itemprop="url">
            <span itemprop="name">Blog Articles</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/projects/" itemprop="url">
            <span itemprop="name">Projects</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/hire-me/" itemprop="url">
            <span itemprop="name">Hire me</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/cv/" itemprop="url">
            <span itemprop="name">Curriculum Vitæ</span>
          </a>
        </li>
      
    
  </ul>
</nav>
        <ul class="contact-list">
  
    <li>
      <a href="mailto:elephwebb@gmail.com">
        <span class="icon icon--email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="313.1 3.7 16 16"><path d="M318.5 8.9c0-.2.2-.4.4-.4h4.5c.2 0 .4.2.4.4s-.2.4-.4.4h-4.5c-.3 0-.4-.2-.4-.4zm.4 2.1h4.5c.2 0 .4-.2.4-.4s-.2-.4-.4-.4h-4.5c-.2 0-.4.2-.4.4s.1.4.4.4zm3.5 1.2c0-.2-.2-.4-.4-.4h-3.1c-.2 0-.4.2-.4.4s.2.4.4.4h3.1c.2.1.4-.1.4-.4zm-1.5-8.4l-1.7 1.4c-.2.1-.2.4 0 .6s.4.2.6 0l1.4-1.2 1.4 1.2c.2.1.4.1.6 0s.1-.4 0-.6l-1.7-1.4c-.3-.1-.5-.1-.6 0zm7.8 6.2c.1.1.1.2.1.3v7.9c0 .8-.7 1.5-1.5 1.5h-12.5c-.8 0-1.5-.7-1.5-1.5v-7.9c0-.1.1-.2.1-.3l1.6-1.3c.2-.1.4-.1.6 0s.1.4 0 .6l-1.2 1 1.8 1.3v-4c0-.6.5-1.1 1.1-1.1h7.5c.6 0 1.1.5 1.1 1.1v4l1.8-1.3-1.2-1c-.2-.1-.2-.4 0-.6s.4-.2.6 0l1.6 1.3zm-11.6 2.2l4 2.8 4-2.8V7.6c0-.1-.1-.2-.2-.2h-7.5c-.1 0-.2.1-.2.2v4.6zm10.9-1l-4.7 3.4 3.4 2.6c.2.1.2.4.1.6-.1.2-.4.2-.6.1l-3.6-2.8-1.2.8c-.1.1-.3.1-.5 0l-1.2-.8-3.6 2.8c-.2.1-.4.1-.6-.1-.1-.2-.1-.4.1-.6l3.4-2.6-4.7-3.4v7.1c0 .4.3.6.6.6h12.5c.4 0 .6-.3.6-.6v-7.1z"/></svg></span>
        <span class="label">Email</span>
      </a>
    </li>
  

  
    <li><a href="https://github.com/elephwebb">
  <span class="icon icon--github"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117 0 0 .67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147 0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"/></svg></span>
  <span class="label">GitHub</span>
</a>
</li>
  

  
    <li><a href="https://twitter.com/MrElephWebb">
  <span class="icon icon--twitter"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812 0-3.282 1.47-3.282 3.28 0 .26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26 0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04 0 9.34-5 9.34-9.33 0-.14 0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"/></svg></span>
  <span class="label">Twitter</span>
</a>
</li>
  

  <li>
    
      <a href="/atom.xml" title="Atom Feed">
        <span class="icon icon--rss"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"/></svg></span>
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>

      </div>
    </div>

    <div class="canvas">
      <div class="wrapper">
        

<header id="masthead">
  <div class="inner">
    <div class="title-area">
      
        <p class="site-title">
          <a href="/">
            
            <span>ElephWebb.io</span>
          </a>
        </p>
      
    </div>
  </div>
</header>

        




<header class="intro">  
   


  
  
  <ul class="breadcrumbs">
    <li>
      <a href="/posts/">
        <svg class="icon icon--back-arrow" width="16px" height="16px"><use xlink:href="/assets/icons/icons.svg#icon-back-arrow"></use></svg> Posts
      </a>
    </li>
  </ul>


  <div class="inner">
    <div class="intro-text">
      <h1 class="intro-title">Building a Test-Driven REST Subscription API
</h1>
      

      
        
          

          <p class="entry-meta">
            <span class="byline-item"><svg class="icon icon--calendar" width="16px" height="16px"><use xlink:href="/assets/icons/icons.svg#icon-calendar"></use></svg><time datetime="2018-02-19T00:00:00-03:00">February 19, 2018</time></span>
            
            
              <span class="byline-item"><svg class="icon icon--stopwatch" width="16px" height="16px"><use xlink:href="/assets/icons/icons.svg#icon-stopwatch"></use></svg>2 min read</span>
            
            
          </p>
        
      

      

      
    </div>
  </div>
</header>

<main id="main" class="page-content" aria-label="Content">
  <div class="inner">
    <article class="entry-wrap">
      <div class="entry-content">
        <h2 id="still-preparing-the-post-and-files">Still preparing the post and files…</h2>

<h2 id="what-we-will-build">What we will build?</h2>

<p>We’re going to build a Subscription System API for Online Services using <a href="https://spring.io/understanding/REST">REST</a> and PHP Laravel 5.6.</p>

<p>The API will implement different Payment Gateways like (Stripe and PayPal), it contains User Authentication and Registration using OAuth - JWT protocol for security.</p>

<p>The code source and online API can be found in <a href="https://github.com/elephwebb/laravel-test-driven-rest-api">GitHub</a> and you can contribute if you want.</p>

<p>Here is the <a href="https://trello.com/b/FVryIUaW">KANBAN</a> of the project.</p>

<h2 id="quick-summary">Quick Summary</h2>

<ul>
  <li><a href="#toolbelt">Toolbelt</a></li>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#business-model">Define Business Model</a></li>
  <li><a href="#requirements">Requirements with KanBan</a></li>
  <li><a href="#rest-api-endpoints">API Endpoints</a></li>
  <li><a href="#design-api">Design API</a></li>
  <li><a href="#pre-testing-the-api">Pre Testing the API</a></li>
  <li><a href="#development-environment">Development Environment</a></li>
  <li><a href="#git-workflow">Git Workflow</a></li>
  <li><a href="#code">Code</a></li>
  <li><a href="#push-always">Push Always</a></li>
  <li><a href="#deploy">Deploy</a></li>
  <li><a href="#measure">Measure</a></li>
</ul>

<p>We will in future split the section <a href="#code">Code</a> in small chunks for better readability.</p>

<h2 id="toolbelt">ToolBelt</h2>

<ul>
  <li>GIT, Varnish AND/OR <a href="http://laradock.io/">Docker</a> - Development Environment</li>
  <li>PHP Laravel, OOP, SOLID, Design Patterns</li>
  <li>APIRY for API Design and Tests</li>
  <li>Postman / SoapUI for simple tests on endpoints</li>
  <li>TravisCI for Continous Integration</li>
  <li>Loader.io for benchmark</li>
  <li>Heroku to publish our API</li>
</ul>

<p>We will pre-built the API Schema and Docs using <a href="https://apiary.io/">APIRY</a> before write a single line of code, mapping our business model/rules to the schema.</p>

<p>Basically the idea is to document the Endpoints using a standard so it’s easier to design, test and colaborate with others developers, so it’s clear what the API does or not without spend time write down software to implement it. It’s important spend some time think what we want to accomplish, what we want to build.</p>

<p>That is our first move toward a <strong>better code</strong> and <strong>client happiness</strong>.</p>

<p>After that we will dive in actually develop it with tests and Laravel best practices in mind to detect errors and behaviors quickly, use SOLID principles and Design Patterns to build an application that can scale.</p>

<p>Push the code with GIT to TravisCI which will automate some tests before deploy to our server, in our case, Heroku.</p>

<p>To monitor the perfomance of our API we will use <a href="https://loader.io/">Loader.io</a>.</p>

<p>We will use <a href="https://www.getpostman.com/">Postman</a> to check the responses from the API, we also will try out <a href="https://www.soapui.org/">SoapUI</a>.</p>

<h2 id="introduction">Introduction</h2>

<p>First of all, why would you like to build an API, it’s crucial to understand the reason behind and why it’s so popular nowadays.</p>

<p>It follows a software architecture called <a href="https://martinfowler.com/articles/microservices.html">Micro Services</a>.</p>

<blockquote>
  <p><cite>In short, the microservice architectural style [1] is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. <a href="https://martinfowler.com/">Martin Fowler</a> and <a href="https://twitter.com/boicy">James Lewis</a></cite></p>
</blockquote>

<p>Not get in too much detail about it and focus on the practical side of code using a test-driven aproach as a key factor inside the <a href="http://agilemanifesto.org/principles.html">Agile Methodology</a>.</p>

<p>I definetly advice take a look at <a href="https://geemus.gitbooks.io/http-api-design/content/en/">HTTP API Designs</a> for more information.</p>

<p>As Phil Sturgeon suggest in his book <a href="https://www.amazon.com/?afiliate_program=jhonyvidal">Building APIs you don’t hate</a>.</p>

<p>Define the API endpoints even if in a piece of paper (or initially)</p>

<ul>
  <li>[ ] <a href="#business-model">Business Model</a></li>
  <li>[ ] <a href="#api-endpoints">API Endpoints</a></li>
</ul>

<h2 id="business-model">Business Model</h2>

<h2 id="rest-api-endpoints">REST API Endpoints</h2>

<h2 id="requirements">Requirements</h2>

<h2 id="design-api">Design Api</h2>

<h2 id="pre-testing-the-api">Pre Testing The Api</h2>

<h2 id="development-environment">Development Environment</h2>

<h2 id="git-workflow">Git Workflow</h2>

<h2 id="code">Code</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="push-always">Push Always</h2>

<h2 id="deploy">Deploy</h2>

<h2 id="measure">Measure</h2>


      </div>
    </article>

    

    <footer id="footer" class="site-footer">
  <div class="copyright">
    
      <p>&copy; 2018 ElephWebb.io.</p>
    
  </div>
</footer>

  </div>
</main>
      </div>
    </div>

    

<script async src="/assets/javascripts/main.js"></script>

  </body>

</html>